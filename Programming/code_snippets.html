<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Code snippets | Signal in the Static</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
    <meta name="description" content="Blog, notes and other stuff">
    <link rel="preload" href="/CompSci/assets/css/0.styles.f0c15ea1.css" as="style"><link rel="preload" href="/CompSci/assets/js/app.9e595c6c.js" as="script"><link rel="preload" href="/CompSci/assets/js/2.5c45e0ed.js" as="script"><link rel="preload" href="/CompSci/assets/js/46.836577ad.js" as="script"><link rel="preload" href="/CompSci/assets/js/17.a8ef3d4e.js" as="script"><link rel="prefetch" href="/CompSci/assets/js/10.e96b1f78.js"><link rel="prefetch" href="/CompSci/assets/js/11.15d03fe7.js"><link rel="prefetch" href="/CompSci/assets/js/12.607376ad.js"><link rel="prefetch" href="/CompSci/assets/js/13.2d52ef55.js"><link rel="prefetch" href="/CompSci/assets/js/14.4e09b710.js"><link rel="prefetch" href="/CompSci/assets/js/15.cd08dde9.js"><link rel="prefetch" href="/CompSci/assets/js/16.e43851b2.js"><link rel="prefetch" href="/CompSci/assets/js/18.1fd4aa25.js"><link rel="prefetch" href="/CompSci/assets/js/19.27c9549f.js"><link rel="prefetch" href="/CompSci/assets/js/20.f3d7487c.js"><link rel="prefetch" href="/CompSci/assets/js/21.0f4e4779.js"><link rel="prefetch" href="/CompSci/assets/js/22.dc34a5f5.js"><link rel="prefetch" href="/CompSci/assets/js/23.96743339.js"><link rel="prefetch" href="/CompSci/assets/js/24.7d200d47.js"><link rel="prefetch" href="/CompSci/assets/js/25.d52b2fff.js"><link rel="prefetch" href="/CompSci/assets/js/26.39e3da81.js"><link rel="prefetch" href="/CompSci/assets/js/27.e7ac0606.js"><link rel="prefetch" href="/CompSci/assets/js/28.48ffd611.js"><link rel="prefetch" href="/CompSci/assets/js/29.89d9f5d0.js"><link rel="prefetch" href="/CompSci/assets/js/3.22b48287.js"><link rel="prefetch" href="/CompSci/assets/js/30.c7929813.js"><link rel="prefetch" href="/CompSci/assets/js/31.4cd2b34f.js"><link rel="prefetch" href="/CompSci/assets/js/32.15bba6fe.js"><link rel="prefetch" href="/CompSci/assets/js/33.44b8035d.js"><link rel="prefetch" href="/CompSci/assets/js/34.72d2463c.js"><link rel="prefetch" href="/CompSci/assets/js/35.93ecf406.js"><link rel="prefetch" href="/CompSci/assets/js/36.022ed979.js"><link rel="prefetch" href="/CompSci/assets/js/37.51b69b2f.js"><link rel="prefetch" href="/CompSci/assets/js/38.3f3eaf3a.js"><link rel="prefetch" href="/CompSci/assets/js/39.e51c39ad.js"><link rel="prefetch" href="/CompSci/assets/js/4.dee1fbce.js"><link rel="prefetch" href="/CompSci/assets/js/40.271b9cf3.js"><link rel="prefetch" href="/CompSci/assets/js/41.1ec9ae84.js"><link rel="prefetch" href="/CompSci/assets/js/42.0045f715.js"><link rel="prefetch" href="/CompSci/assets/js/43.bcbb53c5.js"><link rel="prefetch" href="/CompSci/assets/js/44.b487d58b.js"><link rel="prefetch" href="/CompSci/assets/js/45.af1b4170.js"><link rel="prefetch" href="/CompSci/assets/js/47.7b7d0ca6.js"><link rel="prefetch" href="/CompSci/assets/js/48.3381c289.js"><link rel="prefetch" href="/CompSci/assets/js/49.36ffec01.js"><link rel="prefetch" href="/CompSci/assets/js/5.a67417c4.js"><link rel="prefetch" href="/CompSci/assets/js/50.c8e7b2b9.js"><link rel="prefetch" href="/CompSci/assets/js/51.ae26fa97.js"><link rel="prefetch" href="/CompSci/assets/js/52.c9ca1a44.js"><link rel="prefetch" href="/CompSci/assets/js/53.c071273a.js"><link rel="prefetch" href="/CompSci/assets/js/54.5cfee169.js"><link rel="prefetch" href="/CompSci/assets/js/55.355cf329.js"><link rel="prefetch" href="/CompSci/assets/js/56.59278406.js"><link rel="prefetch" href="/CompSci/assets/js/57.411a8c7f.js"><link rel="prefetch" href="/CompSci/assets/js/58.1af08036.js"><link rel="prefetch" href="/CompSci/assets/js/59.ee63cff6.js"><link rel="prefetch" href="/CompSci/assets/js/6.4ad1abc3.js"><link rel="prefetch" href="/CompSci/assets/js/60.c6504db4.js"><link rel="prefetch" href="/CompSci/assets/js/61.83cf62e1.js"><link rel="prefetch" href="/CompSci/assets/js/7.59e2630f.js"><link rel="prefetch" href="/CompSci/assets/js/8.3720b895.js"><link rel="prefetch" href="/CompSci/assets/js/9.02ee38a7.js">
    <link rel="stylesheet" href="/CompSci/assets/css/0.styles.f0c15ea1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CompSci/" class="home-link router-link-active"><!----> <span class="site-name">Signal in the Static</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/CompSci/" class="nav-link">Home</a></div><div class="nav-item"><a href="/CompSci/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/CompSci/about/" class="nav-link">About</a></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/CompSci/" class="nav-link">Home</a></div><div class="nav-item"><a href="/CompSci/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/CompSci/about/" class="nav-link">About</a></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/CompSci/blog/" class="sidebar-link">Blog</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Notes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/CompSci/Books/" class="sidebar-heading clickable"><span>Books</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/CompSci/CompSci/" class="sidebar-heading clickable"><span>CompSci</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/CompSci/Math/" class="sidebar-heading clickable"><span>Math</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/CompSci/Programming/" class="sidebar-heading clickable router-link-active open"><span>Programming</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/CompSci/Programming/Brightscript.html" class="sidebar-link">Roku Brightscipt and SceneGraph</a></li><li><a href="/CompSci/Programming/Electron.html" class="sidebar-link">Electron</a></li><li><a href="/CompSci/Programming/Golang.html" class="sidebar-link">Golang</a></li><li><a href="/CompSci/Programming/Javascript.html" class="sidebar-link">Javascript</a></li><li><a href="/CompSci/Programming/Python.html" class="sidebar-link">Python</a></li><li><a href="/CompSci/Programming/ReactNative.html" class="sidebar-link">React Native</a></li><li><a href="/CompSci/Programming/Ruby.html" class="sidebar-link">Ruby</a></li><li><a href="/CompSci/Programming/class_theory.html" class="sidebar-link">Object Oriented Programming</a></li><li><a href="/CompSci/Programming/code_snippets.html" aria-current="page" class="active sidebar-link">Code snippets</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CompSci/Programming/code_snippets.html#git" class="sidebar-link">Git</a></li><li class="sidebar-sub-header"><a href="/CompSci/Programming/code_snippets.html#shell-bash" class="sidebar-link">Shell/Bash</a></li><li class="sidebar-sub-header"><a href="/CompSci/Programming/code_snippets.html#js" class="sidebar-link">JS</a></li></ul></li><li><a href="/CompSci/Programming/cpp.html" class="sidebar-link">C++</a></li><li><a href="/CompSci/Programming/js_performance.html" class="sidebar-link">Javascript Performance</a></li><li><a href="/CompSci/Programming/managing_servers.html" class="sidebar-link">[FSM] FullStack notes</a></li><li><a href="/CompSci/Programming/video_engineering.html" class="sidebar-link">Video engineering</a></li><li><a href="/CompSci/Programming/Shell/" class="sidebar-link">Shell programmming</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-solarized-content content__default"><h1 id="code-snippets"><a href="#code-snippets" class="header-anchor">#</a> Code snippets</h1> <p></p><div class="table-of-contents"><ul><li><a href="#git">Git</a><ul><li><a href="#reset-branch-to-the-origin-master">Reset branch to the origin master</a></li><li><a href="#fix-last-commit-message">Fix last commit message</a></li><li><a href="#change-branch-name">Change branch name</a></li><li><a href="#added-a-wrong-file-in-the-repo">Added a wrong file in the repo</a></li></ul></li><li><a href="#shell-bash">Shell/Bash</a><ul><li><a href="#find-processes-at-wanted-port-and-kill-em-all">Find processes at wanted port and kill em all</a></li><li><a href="#copy-your-ssh-public-key-on-a-remote-machine-for-passwordless-login-the-easy-way">Copy your SSH public key on a remote machine for passwordless login - the easy way</a></li><li><a href="#some-command-line-shortcuts">Some command line shortcuts</a></li><li><a href="#massive-change-of-file-extension-bash">Massive change of file extension (bash)</a></li><li><a href="#quickly-rename-a-file">Quickly rename a file</a></li><li><a href="#replace-spaces-in-filenames-with-underscores">Replace spaces in filenames with underscores</a></li><li><a href="#delete-all-files-in-a-folder-that-don-t-match-a-certain-file-extension">Delete all files in a folder that don't match a certain file extension</a></li><li><a href="#sharing-file-through-http-80-port">Sharing file through http 80 port</a></li><li><a href="#copy-a-file-using-pv-and-watch-its-progress">Copy a file using pv and watch its progress</a></li><li><a href="#start-command-and-kill-it-if-still-running-after-5-seconds">Start COMMAND, and kill it if still running after 5 seconds</a></li><li><a href="#broadcast-your-shell-thru-ports-5000-5001-5002">Broadcast your shell thru ports 5000, 5001, 5002</a></li></ul></li><li><a href="#js">JS</a><ul><li><a href="#replace-spaces-with-underscores">Replace spaces with underscores</a></li><li><a href="#check-what-device-is-used">Check what device is used</a></li><li><a href="#getscrollposition">getScrollPosition</a></li><li><a href="#set-scroll-position">Set scroll position</a></li><li><a href="#get-number-from-rgb-color">Get number from RGB color</a></li><li><a href="#and-number-to-color">And number to color</a></li><li><a href="#conditionally-add-properties-to-an-object-literal">Conditionally add properties to an object literal/</a></li><li><a href="#flatten-array">Flatten array</a></li><li><a href="#initialize-new-array">Initialize new array</a></li><li><a href="#partialapplication">partialApplication</a></li><li><a href="#create-an-array-of-the-past-seven-days-inclusive">Create an array of the past seven days, inclusive</a></li><li><a href="#generate-a-random-alphanumerical-string-of-length-11">Generate a random alphanumerical string of length 11</a></li><li><a href="#quines">Quines</a></li><li><a href="#get-the-current-page-s-query-parameters-as-an-object">Get the current pageâ€™s query parameters as an object</a></li><li><a href="#working-clock">Working clock</a></li><li><a href="#shuffle-an-array">Shuffle an array</a></li><li><a href="#generate-random-hex-code">Generate random hex code</a></li><li><a href="#fizz-buzz">Fizz Buzz</a></li><li><a href="#remove-duplicates-from-array">Remove duplicates from array</a></li><li><a href="#wait-util-based-on-date">wait util based on date</a></li><li><a href="#cancelable-promise-util">Cancelable Promise util</a></li></ul></li></ul></div><p></p> <p>[TOC]</p> <hr> <h2 id="git"><a href="#git" class="header-anchor">#</a> Git</h2> <h3 id="reset-branch-to-the-origin-master"><a href="#reset-branch-to-the-origin-master" class="header-anchor">#</a> Reset branch to the origin master</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> fetch origin
<span class="token function">git</span> reset --hard origin/master
</code></pre></div><h3 id="fix-last-commit-message"><a href="#fix-last-commit-message" class="header-anchor">#</a> Fix last commit message</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> commit --amend
</code></pre></div><h3 id="change-branch-name"><a href="#change-branch-name" class="header-anchor">#</a> Change branch name</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> branch -m relaese release
</code></pre></div><p>But if you have already pushed this branch, then there are a couple of extra steps required. The solution for then will be, you need to delete the old branch from the remote and push up the new one.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">### git push origin --delete relaese</span>
<span class="token comment">### git push origin release</span>
</code></pre></div><h3 id="added-a-wrong-file-in-the-repo"><a href="#added-a-wrong-file-in-the-repo" class="header-anchor">#</a> Added a wrong file in the repo</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> reset ./src/.env
</code></pre></div><p>If you have gone committing that change, you just need to run an extra step before:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> reset --soft HEAD~1
<span class="token function">git</span> reset ./src/.env
<span class="token function">rm</span> ./src/.env
<span class="token function">git</span> commit
</code></pre></div><h2 id="shell-bash"><a href="#shell-bash" class="header-anchor">#</a> Shell/Bash</h2> <h3 id="find-processes-at-wanted-port-and-kill-em-all"><a href="#find-processes-at-wanted-port-and-kill-em-all" class="header-anchor">#</a> Find processes at wanted port and kill em all</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># for linux</span>
<span class="token function">netstat</span> -vanp tcp <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">3000</span>
<span class="token comment"># For mac</span>
<span class="token function">sudo</span> <span class="token function">lsof</span> -i tcp:3000

<span class="token function">kill</span> -9 <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span>
</code></pre></div><h3 id="copy-your-ssh-public-key-on-a-remote-machine-for-passwordless-login-the-easy-way"><a href="#copy-your-ssh-public-key-on-a-remote-machine-for-passwordless-login-the-easy-way" class="header-anchor">#</a> Copy your SSH public key on a remote machine for passwordless login - the easy way</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>ssh-copy-id username@hostname
</code></pre></div><h3 id="some-command-line-shortcuts"><a href="#some-command-line-shortcuts" class="header-anchor">#</a> Some command line shortcuts</h3> <div class="language- extra-class"><pre class="language-text"><code>Ctrl+a go to beginning of line
Ctrl+k delete from cursor to end of line
Ctrl+e go to end of line
CTRL U to kill (cut) the whole whole
CTRL Y to paste from kill-ring

</code></pre></div><h3 id="massive-change-of-file-extension-bash"><a href="#massive-change-of-file-extension-bash" class="header-anchor">#</a> Massive change of file extension (bash)</h3> <p>Change the file extension in batch. Useful to create output file names with same input name but distinct extension by including logic inside the loop:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> *.txt<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">mv</span> <span class="token string">&quot;<span class="token variable">$file</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${file<span class="token operator">%</span>.txt}</span>.xml&quot;</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre></div><h3 id="quickly-rename-a-file"><a href="#quickly-rename-a-file" class="header-anchor">#</a> Quickly rename a file</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">mv</span> filename.<span class="token punctuation">{</span>old,new<span class="token punctuation">}</span>
</code></pre></div><h3 id="replace-spaces-in-filenames-with-underscores"><a href="#replace-spaces-in-filenames-with-underscores" class="header-anchor">#</a> Replace spaces in filenames with underscores</h3> <p>This command will replace all the spaces in all the filenames of the current directory with underscores. There are other commands that do this here, but this one is the easiest and shortest.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">rename</span> <span class="token string">'y/ /_/'</span> *
</code></pre></div><h3 id="delete-all-files-in-a-folder-that-don-t-match-a-certain-file-extension"><a href="#delete-all-files-in-a-folder-that-don-t-match-a-certain-file-extension" class="header-anchor">#</a> Delete all files in a folder that don't match a certain file extension</h3> <p>Deletes all files in a folder that are NOT <em>.foo,</em>.bar or *.baz files. Edit the pattern inside the brackets as you like. Show Sample Output</p> <div class="language-js extra-class"><pre class="language-js"><code>
rm <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">.</span>foo<span class="token operator">|</span><span class="token operator">*</span><span class="token punctuation">.</span>bar<span class="token operator">|</span><span class="token operator">*</span><span class="token punctuation">.</span>baz<span class="token punctuation">)</span>
</code></pre></div><h3 id="sharing-file-through-http-80-port"><a href="#sharing-file-through-http-80-port" class="header-anchor">#</a> Sharing file through http 80 port</h3> <p>From the other machine open a web navigator and go to ip from the machine who launch netcat, http://ip-address/ If you have some web server listening at 80 port then you would need stop them or select another port before launch net cat ðŸ˜‰ * You need netcat tool installed</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">nc</span> -v -l <span class="token number">80</span> <span class="token operator">&lt;</span> file.ext
</code></pre></div><h3 id="copy-a-file-using-pv-and-watch-its-progress"><a href="#copy-a-file-using-pv-and-watch-its-progress" class="header-anchor">#</a> Copy a file using pv and watch its progress</h3> <p><code>pv</code> allows a user to see the progress of data through a pipeline, by giving information such as time elapsed, percentage completed (with progress bar), current throughput rate, total data transferred, and ETA. (man pv) Show Sample Output</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pv</span> sourcefile <span class="token operator">&gt;</span> destfile
</code></pre></div><h3 id="start-command-and-kill-it-if-still-running-after-5-seconds"><a href="#start-command-and-kill-it-if-still-running-after-5-seconds" class="header-anchor">#</a> Start COMMAND, and kill it if still running after 5 seconds</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">timeout</span> 5s COMMAND
</code></pre></div><h3 id="broadcast-your-shell-thru-ports-5000-5001-5002"><a href="#broadcast-your-shell-thru-ports-5000-5001-5002" class="header-anchor">#</a> Broadcast your shell thru ports 5000, 5001, 5002</h3> <p>run <code>nc yourip 5000</code>, <code>nc yourip 5001</code> or <code>nc yourip 5002</code> elsewhere will produce an exact same mirror of your shell. This is handy when you want to show someone else some amazing stuff in your shell without giving them control over it.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>script -qf <span class="token operator">|</span> <span class="token function">tee</span> <span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">nc</span> -kl <span class="token number">5000</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">nc</span> -kl <span class="token number">5001</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">nc</span> -kl <span class="token number">5002</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="js"><a href="#js" class="header-anchor">#</a> JS</h2> <h3 id="replace-spaces-with-underscores"><a href="#replace-spaces-with-underscores" class="header-anchor">#</a> Replace spaces with underscores</h3> <div class="language-js extra-class"><pre class="language-js"><code>str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/ /g</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="check-what-device-is-used"><a href="#check-what-device-is-used" class="header-anchor">#</a> Check what device is used</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> userAgent <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>navigator <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isMobile <span class="token operator">=</span> <span class="token regex">/mobile/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isFirefox <span class="token operator">=</span> <span class="token regex">/firefox/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isChrome <span class="token operator">=</span> <span class="token regex">/chrome/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isSafari <span class="token operator">=</span> <span class="token regex">/safari/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>userAgent<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> userAgent<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Chrome'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isEdge <span class="token operator">=</span> <span class="token regex">/edge/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isIE <span class="token operator">=</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>ActiveXObject<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token regex">/trident.*rv:1\d/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isIOS <span class="token operator">=</span> <span class="token regex">/iPad|iPhone|iPod/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="getscrollposition"><a href="#getscrollposition" class="header-anchor">#</a> getScrollPosition</h3> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">getScrollPosition</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            left<span class="token operator">:</span> window<span class="token punctuation">.</span>pageXOffset <span class="token operator">||</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollLeft <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollLeft <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
            top<span class="token operator">:</span> window<span class="token punctuation">.</span>pageYOffset <span class="token operator">||</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="set-scroll-position"><a href="#set-scroll-position" class="header-anchor">#</a> Set scroll position</h3> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">setScrollPosition</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isFirefox<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Check if FF</span>
            document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollLeft <span class="token operator">=</span> left<span class="token punctuation">;</span>
            document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> top<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="get-number-from-rgb-color"><a href="#get-number-from-rgb-color" class="header-anchor">#</a> Get number from RGB color</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">color2Number</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		color <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x000000</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="and-number-to-color"><a href="#and-number-to-color" class="header-anchor">#</a> And number to color</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">number2Color</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'#'</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'00000'</span> <span class="token operator">+</span> number<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="conditionally-add-properties-to-an-object-literal"><a href="#conditionally-add-properties-to-an-object-literal" class="header-anchor">#</a> Conditionally add properties to an object literal/</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// spreads `{ prop }` obj over outer obj if conditional check passes</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token punctuation">(</span>prop <span class="token operator">&amp;&amp;</span> <span class="token punctuation">{</span> prop <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Obviously this syntax fails for falsy values, so more specific conditional check would be needed.</p> <h3 id="flatten-array"><a href="#flatten-array" class="header-anchor">#</a> Flatten array</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">arrayOfArrays</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> arrayOfArrays<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token operator">...</span>acc<span class="token punctuation">,</span> <span class="token operator">...</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Flattens arrays one level deep, make recursive to flatten n-levels deep.</p> <h3 id="initialize-new-array"><a href="#initialize-new-array" class="header-anchor">#</a> Initialize new array</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">NEW_ARRAY_LENGTH</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token constant">NEW_ARRAY_LENGTH</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="partialapplication"><a href="#partialapplication" class="header-anchor">#</a> partialApplication</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">partialApplication</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> <span class="token operator">...</span>initialArguments</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>remainingArguments</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>initialArguments<span class="token punctuation">,</span> <span class="token operator">...</span>remainingArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="create-an-array-of-the-past-seven-days-inclusive"><a href="#create-an-array-of-the-past-seven-days-inclusive" class="header-anchor">#</a> Create an array of the past seven days, inclusive</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">days</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">86400000</span> <span class="token operator">*</span> days<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you swap the minus for a plus, it gives you the next seven days.</p> <h3 id="generate-a-random-alphanumerical-string-of-length-11"><a href="#generate-a-random-alphanumerical-string-of-length-11" class="header-anchor">#</a> Generate a random alphanumerical string of length 11</h3> <div class="language-js extra-class"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="quines"><a href="#quines" class="header-anchor">#</a> <em>Quines</em></h3> <blockquote><p>A <a href="https://en.wikipedia.org/wiki/Quine_(computing)" target="_blank" rel="noopener noreferrer">quine<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is a program that outputs its own source code.</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// $=_=&gt;`$=${$};$()`;$()</span>
<span class="token function-variable function">$</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;$()</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// eval(I=&quot;'eval(I='+JSON.stringify(I)+')'&quot;)</span>
<span class="token function">eval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">I</span> <span class="token operator">=</span> <span class="token string">&quot;'eval(I='+JSON.stringify(I)+')'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
	<span class="token comment">// For those who like their quines via alert</span>
	<span class="token comment">// (function a(){alert(&quot;(&quot;+a+&quot;)()&quot;)})()</span>
	<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'('</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token string">')()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="get-the-current-page-s-query-parameters-as-an-object"><a href="#get-the-current-page-s-query-parameters-as-an-object" class="header-anchor">#</a> Get the current pageâ€™s query parameters as an object</h3> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search
	<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^\?)/</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		n <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		o<span class="token punctuation">[</span>n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> o<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="working-clock"><a href="#working-clock" class="header-anchor">#</a> <em>Working clock</em></h3> <blockquote><p>it ticks every second, updating the page with the current time.</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span>
	<span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>setInterval(()=&gt;document.body.innerHTML=new Date().toGMTString().slice(17,25))<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="shuffle-an-array"><a href="#shuffle-an-array" class="header-anchor">#</a> <em>Shuffle an array</em></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Return a shuffled copy of an Array-like</span>
<span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="generate-random-hex-code"><a href="#generate-random-hex-code" class="header-anchor">#</a> <em>Generate random hex code</em></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Generate a random hex code such as `#c618b2`</span>
<span class="token string">'#'</span> <span class="token operator">+</span>
	Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0xffffff</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="fizz-buzz"><a href="#fizz-buzz" class="header-anchor">#</a> Fizz Buzz</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token operator">&lt;</span> <span class="token number">101</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">?</span> f <span class="token operator">||</span> i <span class="token operator">:</span> f <span class="token operator">+</span> <span class="token string">'Buzz'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> f <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'Fizz'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="remove-duplicates-from-array"><a href="#remove-duplicates-from-array" class="header-anchor">#</a> <em>Remove duplicates from array</em></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Remove duplicates from the iterable `arr`</span>
<span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="wait-util-based-on-date"><a href="#wait-util-based-on-date" class="header-anchor">#</a> <code>wait</code> util based on date</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * @param {number} s
 * @return {undefined}
 */</span>
<span class="token keyword">function</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">/** @type {number} */</span>
	<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/** @type {number} */</span>
	<span class="token keyword">var</span> t <span class="token operator">=</span> b<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> b <span class="token operator">+</span> s<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">/** @type {number} */</span>
		t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="cancelable-promise-util"><a href="#cancelable-promise-util" class="header-anchor">#</a> <em>Cancelable Promise util</em></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">cancelable</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> hasCancelled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		promise<span class="token operator">:</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>hasCancelled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> <span class="token punctuation">{</span> isCancelled<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> v<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token function-variable function">cancel</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>hasCancelled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>When we call the cancelable function by giving it a promise we'll get an object that has a:</p> <ul><li><code>promise</code> property: original promise extended with a single <code>.then</code> handler that is able to cancel out all the following <code>.then</code> handlers appended to it later on. Cancellation is based on a local variable hasCancelled. If the flag turns to true before the promise resolves it throws with additional information and bypasses all the latter <code>.then</code> handlers. We should use this property instead of our original promise and append any required <code>.then</code> handlers to it.</li> <li><code>cancel</code> method that changes the local hasCancelled flag to true</li></ul> <p>Usage example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mocked fetch function to simulate waiting for a result 10 seconds</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
	<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'response'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> promise<span class="token operator">:</span> result<span class="token punctuation">,</span> cancel <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">cancelable</span><span class="token punctuation">(</span><span class="token function">fetchResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

result<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>isCancelled<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise chain cancelled!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Handler 1: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Handler 2: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Handler 3: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// at any point in time we can cancel all of the above success handlers by using cancel function</span>
<span class="token comment">// catch handler can verify if cancellation is the reason of failure and do something based on it, in this case log out &quot;Promise chain cancelled!&quot;</span>
<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It's important to note that by using this approach we can't cancel out any handlers that were attached directly to an original promise object passed to our util function. This mechanism is only able to cancel out .then handlers appended to the returned promise. A bit weird but it's not bad once you get used to it. You can still hold a reference to both the original and derived promise.</p> <p>Another note is that error with isCancelled flag ends up in the catch handler only when the original Promise eventually resolves. All of this is essentially a way for us to say: once and if this Promise resolves, skip the success handlers because we are not interested in handling this data anymore.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/12/2020, 2:10:42 PM</span></div></footer> <!----> </main></div><div class="global-ui"><div style="visibility:hidden;display:none;"></div></div></div>
    <script src="/CompSci/assets/js/app.9e595c6c.js" defer></script><script src="/CompSci/assets/js/2.5c45e0ed.js" defer></script><script src="/CompSci/assets/js/46.836577ad.js" defer></script><script src="/CompSci/assets/js/17.a8ef3d4e.js" defer></script>
  </body>
</html>
